<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户——管理用户</title>
    <meta name="keywords" content="#">
    <meta name="description" content="#">
    	
	<!-- 公用CSS -->
    <link href="http://admin.nmop.cn/static/admin/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://admin.nmop.cn/static/admin/fontawesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://admin.nmop.cn/static/admin/css/animate.min.css" rel="stylesheet">
    <link href="http://admin.nmop.cn/static/admin/css/style.css" rel="stylesheet">
    	
    <!-- 外部插件——bootstrap表格插件CSS -->
	<link href="http://admin.nmop.cn/static/admin/bootstrap-table/1.10.1/bootstrap-table.css" rel="stylesheet">
	<link href="http://admin.nmop.cn/static/admin/apps/settings/css/bootstrap-editable/bootstrap-editable.css" rel="stylesheet">
	
	<!-- 外部插件——消息提示插件CSS -->
	<link href="http://admin.nmop.cn/static/admin/apps/settings/css/sweet-alert/sweet-alert.css" rel="stylesheet">
	
	<!-- 外部插件——表单选择框插件CSS -->
	<link href="http://admin.nmop.cn/static/admin/apps/settings/css/iCheck/custom.css" rel="stylesheet">
	
	<!-- 公用 JS -->
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://admin.nmop.cn/static/admin/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    	
	<!-- 外部插件——bootstrap表格插件JS-->
	<script src="http://admin.nmop.cn/static/admin/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
    <script src="http://admin.nmop.cn/static/admin/bootstrap-table/1.10.1/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/editable/bootstrap-table-editable.js"></script>
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/editable/bootstrap3-editable.js"></script>
    
    <!-- 外部插件——JQ表单验证插件JS-->
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/jquery.validate.js/jquery.validate.min.js"></script>
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/jquery.validate.js/messages_zh.min.js"></script>
    
    <!-- 外部插件——消息提示插件JS-->
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/sweet-alert/sweet-alert.js"></script>
    
    <!-- 外部插件——表单选择框插件JS-->
    <script src="http://admin.nmop.cn/static/admin/apps/settings/js/iCheck/icheck.min.js"></script>
	    
</head>
<body class="gray-bg">
	
	<!-- 头部面包屑导航开始 -->
	<div class="page-heading" style="padding: 20px;">
		<h3>用户</h3>
		<ul class="breadcrumb">
		  <li><a href="globalConfig_siteInfo.html">用户</a></li>
		  <li class="active">管理用户</li>
		</ul>
	</div>
	<!-- 头部面包屑导航结束 -->
	
	<!-- 身体包裹层开始 -->
    <div class="wrapper wrapper-content animated fadeInRight">
    	<div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <!--tab-content start-->
                        <div class="tab-content">	
                    		<!--exampleTableEventsToolbar start-->
                    		<div class="btn-group hidden-xs" role="group">
                            	<div class="row">
                            		<div class="col-sm-12">
                            			<div id="toolbar">
		                        			<button type="button" class="btn btn-primary"  id="addBtn" data-toggle="modal" data-target="#addUserModal">
									   			<i class="glyphicon glyphicon-plus"></i>添加
									   		</button>
									   		<button type="button" class="btn btn-primary"  id="moveBtn" data-toggle="modal" data-target="#moveUserModal">
									   			<i class="glyphicon glyphicon-plus"></i>移动
									   		</button>
	                                    	<div class="btn-group">
	                                    		<button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown">
			                                            <span>全部</span><span class="caret"></span>
			                                    </button>
			                                    <ul class="dropdown-menu">
												    <li><a href="#">全部</a></li>
												    <li class="divider"></li>
												    <li><a href="#" data-field="group">管理员</a></li>
												    <li><a href="#" data-field="group">待验证</a></li>
												    <li><a href="#" data-field="group">待审核</a></li>
												    <li><a href="#" data-field="group">禁用</a></li>
												    <li><a href="#" data-field="group">注册用户</a></li>
												    <li><a href="#" data-field="group">VIP</a></li>
												    <li><a href="#" data-field="group">手机注册用户</a></li>
												</ul>
	                                    	</div>
									        <button id="remove" class="btn btn-danger" disabled>
									            <i class="glyphicon glyphicon-remove"></i> 删除
									        </button>
									    </div>
                            		</div>
                            	</div>
                            </div>
                    		<!--texampleTableEventsToolbar end-->
                    		
                    		<!--exampleTableEvents start-->
                            <table id="table" class="table table-hover">
					    	</table>
                    		<!--exampleTableEvents end-->
                        </div>
                        <!--tab-content end-->
						
                    </div><!--ibox-content end-->
                </div><!--ibox end-->
            </div><!--col-sm-12 end-->
        </div><!--row end-->
    </div>
    <!-- 身体包裹层结束 -->
    
	 <!-- 错误信息开始 -->
	<div id="errorMsg" style="font-size: 30px; color: red; text-align: center;"></div>  
	<!-- 错误信息结束 --> 
	
    <!-- 添加用户模态弹出框开始 -->
    <div class="modal" id="addUserModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title">添加用户</h4>
				</div>
				<div class="modal-body">
                    <form class="form-horizontal" id="addUserForm">
                		<div class="form-group">
                			<label for="username" class="col-sm-3 control-label">用户名：</label>
						    <div class="col-sm-7">
						      <input type="text"  class="form-control" placeholder="请输入您的用户名" required="required" name="ausername">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="password" class="col-sm-3 control-label">密码：</label>
						    <div class="col-sm-7">
						      <input type="password"  class="form-control" placeholder="请输入您的密码" required  name="apassword">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">E-mail：</label>
						    <div class="col-sm-7">
						      <input type="email" class="form-control" placeholder="请输入您的E-mail" name="aemail" required="required">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">电话号码：</label>
						    <div class="col-sm-7">
						      <input type="tel" class="form-control" placeholder="请输入您的电话" name="atelephone">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">登录限制：</label>
						    <div class="col-sm-7">
						      <input type="number" class="form-control" placeholder="请输入您的地址" name="aforbid">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">用户组：</label>
						    <div class="col-sm-7">
						      	<select class="form-control" name="group" required="required">
						      		<option>待验证</option>
						      		<option>待审核</option>
						      		<option>禁用</option>
						      		<option>注册用户</option>
						      		<option>VIP</option>
						      		<option>手机注册用户</option>
						      	</select>
						    </div>
                		</div>
					</form>
				</div>
				<div class="modal-footer">
					<div class="col-sm-offset-3">
				    	<button type="submit" class="btn btn-primary" id="submit1" data-dismiss="modal">确定</button>
                    	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				    </div>
				</div>
			</div>
		</div>
	</div>
    <!-- 添加用户模态弹出框结束 -->	
    
    <!-- 移动用户模态弹出框开始 -->
    <div class="modal" id="moveUserModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title">添加用户组</h4>
				</div>
				<div class="modal-body">
                    <form class="form-horizontal" id="moveUserForm">
                		<div class="form-group">
                			<label for="group" class="col-sm-4 control-label">将目标移到用户组：</label>
						    <div class="col-sm-7">
						      	<div class="radio i-checks">
                                	<label><input type="radio" value="option1" name="a"> <i></i> 待验证</label>
                            	</div>
                            	<div class="radio i-checks">
                                	<label><input type="radio" value="option2" name="a"> <i></i> 待审核</label>
                            	</div>
                            	<div class="radio i-checks">
                                	<label><input type="radio" value="option3" name="a"> <i></i> 禁用</label>
                            	</div>
                            	<div class="radio i-checks">
                                	<label><input type="radio" value="option4" name="a"> <i></i> 注册用户</label>
                            	</div>
                            	<div class="radio i-checks">
                                	<label><input type="radio" value="option5" name="a"> <i></i> VIP</label>
                            	</div>
                            	<div class="radio i-checks">
                                	<label><input type="radio" value="option5" name="a"> <i></i> 手机注册用户</label>
                            	</div>
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
					</form>
				</div>
				<div class="modal-footer">
					<div class="col-sm-offset-3">
				    	<button type="submit" class="btn btn-primary" id="submit2" data-dismiss="modal">确定</button>
                    	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				    </div>
				</div>
			</div>
		</div>
	</div>
    <!-- 移动用户模态弹出框结束 -->
    
    <!-- 修改用户资料模态弹出框开始 -->
    <div class="modal" id="editUserModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title">修改用户资料</h4>
				</div>
				<div class="modal-body">
                    <form class="form-horizontal" id="editUserForm">
                		<div class="form-group">
                			<label for="username" class="col-sm-3 control-label">用户名：</label>
						    <div class="col-sm-7">
						      <input type="text"  class="form-control" value="" disabled="disabled">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">用户组：</label>
						    <div class="col-sm-7">
						      	<select class="form-control" name="group" required="required">
						      		<option>待验证</option>
						      		<option>待审核</option>
						      		<option>禁用</option>
						      		<option>注册用户</option>
						      		<option>VIP</option>
						      		<option>手机注册用户</option>
						      	</select>
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">E-mail：</label>
						    <div class="col-sm-7">
						      <input type="email" class="form-control" placeholder="请输入您的E-mail" name="aemail">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">真实姓名：</label>
						    <div class="col-sm-7">
						      <input type="email" class="form-control" name="aname">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">限制次数：</label>
						    <div class="col-sm-7">
						      <input type="number" class="form-control" placeholder="0" name="aforbid1" min="0">
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">已登录次数：</label>
						    <div class="col-sm-7">
						      <div class="input-group">
                                    <input type="number" class="form-control" min="0"> 
                                    	<span class="input-group-btn"> 
                                    		<button type="button" class="btn btn-primary">清零
                                    		</button> 
                                    	</span>
                                </div>
						    </div>
                		</div>
                		<div class="hr-line-dashed"></div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">电话：</label>
						    <div class="col-sm-7">
						      <input type="tel" class="form-control" placeholder="请输入您的电话" name="atelephone">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">手机：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control" placeholder="请输入您的手机号" name="mobile">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">职业：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control"  name="profesion">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">地址：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control" placeholder="请输入您的地址" name="address">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">邮编：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control"  name="postcode">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">QQ：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control" placeholder="请输入您的qq" name="QQ">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">MSN：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control" placeholder="请输入您的msn" name="msn">
						    </div>
                		</div>
                		<div class="form-group">
                			<label for="name" class="col-sm-3 control-label">备注：</label>
						    <div class="col-sm-7">
						      <input type="text" class="form-control" name="note">
						    </div>
                		</div>
					</form>
				</div>
				<div class="modal-footer">
					<div class="col-sm-offset-3">
				    	<button type="submit" class="btn btn-primary" id="submit3" data-dismiss="modal">确定</button>
                    	<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				    </div>
				</div>
			</div>
		</div>
	</div>
    <!-- 修改用户资料模态弹出框结束 -->	
    
<script>
/*设置变量*/
var 	$table = $('#table'),
    	$remove = $('#remove'),
    	$add=$('#add'),
    	selections = [];
    	
/*初始化函数*/   	
function initTable() {
    $table.bootstrapTable({
    	height: getHeight(),
    	url: 'user_manage.json',
	    method: 'get',
	    toolbar: '#toolbar',
	    pagination: false,
	    sidePagination: "server",
	    queryParamsType: 'page',
	    pageNumber:1,
	    pageSize: 10,
	    pageList: [10, 25, 50, 100],
	    search: true,
	    sortable:true,
	    idField:"userid",
	    showColumns: true,
	    showRefresh: true,
	    showToggle: true,
	    showPaginationSwitch:true,
	    responseHandler:responseHandler,
        columns: [{
	        field: 'choose',
	        checkbox: true,
	        align: 'center',
	        valign: 'middle'
	    }, 
	    {
	        title: 'ID',
	        field: 'userid',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    }, 
	    {
	        title: '手机号',
	        field: 'mobile',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    }, 
	    {
	        title: 'E-mail',
	        field: 'email',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    },
	    {
	        title: '用户组',
	        field: 'group',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    },
	    {
	        title: '注册时间',
	        field: 'regtime',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    },
	    {
	        title: '最后登录',
	        field: 'lastlogintime',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        footerFormatter: totalTextFormatter
	    },
	    {
	    	title: '管理操作',
	    	field: 'operate',
	        align: 'center',
	        valign: 'middle',
	        sortable: true,
	        events: operateEvents,
	        formatter: operateFormatter
		}
	]
});

/*删除按钮的状态*/ 
$table.on('check.bs.table uncheck.bs.table ' +
            'check-all.bs.table uncheck-all.bs.table', function () {
    $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
    selections = getIdSelections();
});

/*点击删除按钮*/ 
$remove.click(function () {
    var ids = getIdSelections();
    swal({
        title: "确认删除吗？",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#1ab394",
        confirmButtonText: "是，删除",
        cancelButtonText: "不，取消",
        closeOnConfirm: false,
        closeOnCancel: true 
		},
        function (isConfirm) {
            if (isConfirm) {
               	swal("Deleted!", "你的记录删除成功", "success");
              	$table.bootstrapTable('remove', {
	                field: 'userid',
	                values: ids
	            });
	             $remove.prop('disabled', true);
            }
        });
       
    });
}

/*对响应体操作*/ 
function responseHandler(res) {
	return res.total?{"rows": res.data,"total": res.total}:{"rows": [],"total": 0}
};

/*获取元素的userid*/
function getIdSelections() {
    return $.map($table.bootstrapTable('getSelections'), function (row) {
        return row.userid
    });
}

/*获取元素的data数据*/ 
function getData(){
    return $table.bootstrapTable('getData')
};

 /*获取表格的高度*/ 
function getHeight() {
    return $(window).height();
};

/*获取全部表格个数*/
function totalTextFormatter(data) {
    return 'Total';
};

/*toolbar操作*/ 
$('#toolbar .dropdown-menu a').on('click',function(){
	$(this).parents('ul').children().removeClass('active');
	$(this).parent('li').addClass('active');
	var btnHtml=$(this).html()+'<span class="caret" style="margin-left:15px;"></span>';
	$(this).parents('ul').siblings('button').html(btnHtml);
	if($(this).data('field')=='group'){
		var dfh=$(this).html();
		var gD=getData();
		var arr=[];
		$.each(gD,function(i,n){
			if(gD[i].group==dfh){
				arr.push(i)
			}
		})
		for(var i=0;i<getData().length;i++){
			 $table.bootstrapTable('hideRow', {
            	index:i
        	});
		}
		$.each(arr,function(i,item){
			$table.bootstrapTable('showRow', {
            	index:arr[i]
       		});
		})
	}
	if($(this).html()=="全部"){
		$.each(getData(),function(i,n){
			$table.bootstrapTable('showRow', {
            	index:i
       		});
		})
	}
})

/*删除按钮的状态*/
$table.on('check.bs.table uncheck.bs.table ' +
                 'check-all.bs.table uncheck-all.bs.table', function () {
    $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
    selections = getIdSelections();
});

/*点击删除按钮*/ 
$remove.click(function () {
    var ids = getIdSelections();
    swal({
        title: "确认删除吗？",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#1ab394",
        confirmButtonText: "是，删除",
        cancelButtonText: "不，取消",
        closeOnConfirm: false,
        closeOnCancel: true 
		},
        function (isConfirm) {
            if (isConfirm) {
               	swal("Deleted!", "你的记录删除成功", "success");
              	$table.bootstrapTable('remove', {
	                field: 'userid',
	                values: ids
	            });
	            $remove.prop('disabled', true);
            }
    });
    $(window).resize(function () {
        $table.bootstrapTable('resetView', {
            height: getHeight()
        });
    });
});

/*动态添加操作栏*/
function operateFormatter(value, row, index) {
    return [
    	/*'<button class="btn editIP"  title="点击添加新用户IP" style="border:none;background:none" data-toggle="modal">',
        '<i class="glyphicon glyphicon-floppy-disk"></i>',
        '</button>',
        '<button class="btn editIPGroup"  title="点击修改用户套餐包" style="border:none;background:none" data-toggle="modal">',
        '<i class="glyphicon glyphicon-cog"></i>',
        '</button>',*/
    	'<button class="btn edit"  title="点击编辑" style="border:none;background:none" data-toggle="modal">',
        '<i class="glyphicon glyphicon-edit"></i>',
        '</button>',
        '<button class="btn remove"  title="点击删除" style="border:none;background:none">',
        '<i class="glyphicon glyphicon-remove"></i>',
        '</button>'
    ].join('');
};

/*给操作栏添加点击行为*/ 
window.operateEvents = {
   	'click .edit':function (e, value, row, i) {
   		$("#editUserModal").modal("toggle");
   		$('#username').val(row.username);
   		$('#department option,#role option').each(function(){
   			if($(this).html()==row.department||$(this).html()==row.role){
   				$(this).attr('selected','selected')
   			}
   		})
    },
    'click .remove': function (e, value, row, index) {
    	swal({
            title: "确认删除吗？",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#1ab394",
            confirmButtonText: "是，删除",
            cancelButtonText: "不，取消",
            closeOnConfirm: false,
            closeOnCancel: true 
    		},
            function (isConfirm) {
                if (isConfirm) {
                   	swal("Deleted!", "你的记录删除成功", "success");
                  	$table.bootstrapTable('remove', {
		                field: 'userid',
			                values: [row.userid]
			            });
                    }
                });
        }
    };
 
 /*ajax全局设置*/ 
	$.ajaxSetup({
	    type:"POST",
		cache:false,
		dataType: "json",
		success:function(msg){
			alert('保存信息成功！')
		},
		error:function(data, textStatus, xhr){
			$('#errorMsg').html(data.status+"错误");
		}
	});	
	/*提交注册设置表单*/
	$('#addUserForm').validate({
		submitHandler:function(){
			$("#submit1").bind("click", function(){
				var addAdmin=$('#addUserForm').serialize();
				$.ajax({
					url:"xxx.json",
					data:addAdmin
				});
			});
		}
	})
	
	/*提交ucenter整合表单*/ 
	$('#moveUserForm').validate({
		submitHandler:function(){
			$("#submit2").bind("click", function(){
				var addAdmin=$('#moveUserForm').serialize();
				$.ajax({
					url:"xxx.json",
					data:addAdmin
				});
			});
		}
	})
	
	/*提交PHPwind整合表单*/ 
	$('#editUserForm').validate({
		submitHandler:function(){
			$("#submit3").bind("click", function(){
				var addAdmin=$('#editUserForm').serialize();
					$.ajax({
					url:"xxx.json",
					data:addAdmin
				});
			})
		}
	})
 
/*DOM加载完成执行初始化函数*/
$(function(){
	initTable();
	$(".i-checks").iCheck({
		checkboxClass:"icheckbox_square-green",
		radioClass:"iradio_square-green"
	});
});
</script>
</body>
</html>

